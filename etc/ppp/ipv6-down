#!/bin/ash

# Do not edit this file, use ip-up.local instead.

# (C) 1997-2004 SuSE Linux AG, Nuernberg, Germany
# Klaus Franken 25.02.1998
# Remo Behn 18.07.1998
# Arvin Schnell 28.02.2002
# Ludwig Nussel 26.02.2004
# Send suggestions and comments to http://www.suse.de/feedback/

BASENAME=${0##*/}
INTERFACE=$1
DEVICE=$2
SPEED=$3
LOCALIP=$4
REMOTEIP=$5
IPPARAM=$6


PID_FILE="/var/run/$INTERFACE.script"
IF_CONFIG="/var/ipv6/pppclient/$INTERFACE/pppv6_config"
#IF_STATUS="/var/ipv6/pppclient/$INTERFACE/status"
#PARA_FILE="/var/wan/flag"

# get wan process id
pid=
get_pid()
{
	read pid < $PID_FILE
}

# write bbsp flag, the flag identify the wan status change 
write_flag()
{
	echo 5 > $PARA_FILE
}

# send signal to notify the change of wan status 
send_sig()
{
	get_pid	
	kill -SIGUSR1 $pid 
}

# write ipcp info to config file 
write_config()
{
	echo > $IF_CONFIG
	[ -n "$IPLOCAL" ] && echo ip= $IPLOCAL >> $IF_CONFIG
	[ -n "$DNS1" -a -n "$DNS2" ] && echo dns= $DNS1 $DNS2>> $IF_CONFIG
}

# clear config file 
clear_config()
{
	echo > $IF_CONFIG
}

# change status
disconnect=6
set_disconnect()
{
	echo $disconnect > $IF_STATUS
}

#########
case "$BASENAME" in
    ipv6-down)
	clear_config	
	get_pid
	send_sig
	;;
esac

