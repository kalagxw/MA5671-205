#!/bin/ash

# Do not edit this file, use ip-up.local instead.

# (C) 1997-2004 SuSE Linux AG, Nuernberg, Germany
# Klaus Franken 25.02.1998
# Remo Behn 18.07.1998
# Arvin Schnell 28.02.2002
# Ludwig Nussel 26.02.2004
# Send suggestions and comments to http://www.suse.de/feedback/

BASENAME=${0##*/}

PID_FILE="/var/wan/pid"
IF_CONFIG="/var/wan/ppp0/config"
PARA_FILE="/var/wan/flag"


# get wan process id
pid=
get_pid()
{
	read pid < $PID_FILE
}

# write bbsp para, the flag identify the pppoe emulation 
write_flag()
{
	echo 2 > $PARA_FILE
}

# send signal to notify the exit of pppoe em wan 
send_sig()
{	
    #write_flag
    if [ "$PPPD_PID" = "0" ]
    then
        echo "Get pppd pid failed during running exit script!" > $IF_CONFIG
    else
        kill -23 $PPPD_PID 
        fi
}

# write ipcp info to config file 
write_config()
{
	echo > $IF_CONFIG
	[ -n "$EXIT_ERR" ] && echo ppp_exit_err= $EXIT_ERR >> $IF_CONFIG
}

#########	
case "$BASENAME" in
    exit)
	write_config		
	send_sig
	;;
esac
